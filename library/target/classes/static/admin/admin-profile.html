<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SB Admin 2 - Dashboard</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
            href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
            rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>


</head>

<body id="page-top">
<style>
    .student-profile .card {
        border-radius: 10px;
    }

    .student-profile .card .card-header .profile_img {
        width: 150px;
        height: 150px;
        object-fit: cover;
        margin: 10px auto;
        border: 10px solid #ccc;
        border-radius: 50%;
    }
    .student-profile .card h3 {
        font-size: 20px;
        font-weight: 700;
    }
    .student-profile .card p {
        font-size: 16px;
        color: #000;
    }


    .col-lg-8{
        position: relative;
        left:40px;
    }
</style>

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-laugh-wink"></i>
            </div>
            <div class="sidebar-brand-text mx-3">SB Admin <sup>2</sup></div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0">

        <!-- Nav Item - Dashboard -->
        <li class="nav-item ">
            <a class="nav-link" href="index.html">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>Dashboard</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
            Interface
        </div>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link" href="members.html">
                <i class='bx bx-male-female'></i>
                <span>Members</span>
            </a>

        </li>

        <!-- Nav Item - Utilities Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link" href="books.html">
                <i class='bx bxs-add-to-queue' ></i>
                <span>Books</span>
            </a>

        </li>


        <li class="nav-item">
            <a class="nav-link" href="show-categories.html">
                <i class='bx bx-archive-in' ></i>
                <span>Categories</span>
            </a>

        </li>
        <!-- Divider -->
        <hr class="sidebar-divider">


        <!-- Nav Item - Pages Collapse Menu -->

        <!-- Nav Item - Charts -->


        <!-- Sidebar Message -->
        <!-- <div class="sidebar-card d-none d-lg-flex">
            <img class="sidebar-card-illustration mb-2" src="img/undraw_rocket.svg" alt="...">
            <p class="text-center mb-2"><strong>SB Admin Pro</strong> is packed with premium features, components, and more!</p>
            <a class="btn btn-success btn-sm" href="https://startbootstrap.com/theme/sb-admin-pro">Upgrade to Pro!</a>
        </div> -->

    </ul>

    <div class="student-profile py-4">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-header bg-transparent border-0">
                            <h3 class="mb-0"><i class="far fa-clone pr-1"></i>Your Profile Data</h3>
                        </div>
                        <div class="card-body pt-0">
                            <form method="post" id="updateForm"  enctype="multipart/form-data">
                                <div class="form-group">
                                    <label for="name">Name:</label>
                                    <input type="text" class="form-control" id="name" name="name" value=""  aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="email">Email:</label>
                                    <input type="email" pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{1,63}$" class="form-control" id="email" name="email" value="" aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="phone">Phone:</label>
                                    <input type="text" class="form-control" id="phone" name="phone" value="" aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="old_password">Password:</label>
                                    <input type="password" class="form-control" name="old_password" id="old_password" value="" aria-required="true" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="repeat_old_password">Current Password:</label>
                                    <input type="password" class="form-control" name="repeat_old_password" id="repeat_old_password" value="" placeholder="Enter your current password to update if want">
                                </div>
                                <div class="form-group">
                                    <label for="new_password">New Password:</label>
                                    <input type="password" class="form-control" name="new_password" id="new_password" value="" placeholder="Write new password to update">
                                </div>
                                <div class="form-group">
                                    <label for="repeat_new_password">Repeat New Password:</label>
                                    <input type="password" class="form-control" name="repeat_new_password" id="repeat_new_password" value="" placeholder="Repeat new password"  >
                                </div>
                                <div class="form-group">
                                    <label>Gender:</label><br>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="gender" id="male" value="male" aria-required="true" >
                                        <label class="form-check-label" for="male">Male</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="gender" id="female" value="female" aria-required="true" >
                                        <label class="form-check-label" for="female">Female</label>
                                    </div>

                                </div>
                                <div class="form-group">
                                    <label for="userRole">User Role:</label>
                                    <input type="text" class="form-control" id="userRole" value="" readonly>
                                </div>

                                <input class="btn btn-primary  mb-4 text-center" id="updateButton" type="submit" value="Update"/>
                                <!--<div class="form-group">
                                    <input class="btn btn-primary mb-4 text-center" id="updateButton" type="button" value="Update" onclick="updateUser(event)"/>
                                </div>-->
                               <!-- <button type="submit"  id="updateButton" class="btn btn-primary  mb-4 text-center">Update</button>-->
                            </form>
                            <div style="height: 26px"></div>
                            <div class="card shadow-sm">
                                <div class="card-header bg-transparent border-0">
                                    <h3 class="mb-0"><i class="far fa-clone pr-1"></i>Quote for today</h3>
                                </div>
                                <div class="card-body pt-0">
                                    <p>"Libraries were full of ideas-perhaps the most dangerous and powerful of all weapons" </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- </div>
                  </div>
                </div>
              </div> -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/chart-area-demo.js"></script>
    <script src="js/demo/chart-pie-demo.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <script>
    function GetUserData() {
        var url = "http://localhost:8090/User/getUserById/" + localStorage.getItem("userId");

        $.ajax({
            url: url,
            type: "GET",
            dataType: "json",
            success: function (data) {
                $("#name").val(data.name);
                $("#email").val(data.email);
                $("#phone").val(data.phone);
                $("#old_password").val(data.password);
                $("#userRole").val(data.userRole);
                if (data.gender === "male") {
                    $("#male").prop("checked", true);
                }
                else if (data.gender === "female") {
                    $("#female").prop("checked", true);
                }
            },
            error: function () {
                console.log("Error");
            }
        });
    }

    GetUserData();

</script>
    <script>
        $(document).ready(function() {
            $("#updateButton").click(updateUser);
        });
    </script>
    <script>
        function updateUser(event) {
            event.preventDefault(); // Prevent the default form submission behavior

            var name = $("#name").val();
            var email = $("#email").val();
            var phone = $("#phone").val();
            var gender = $("input[name='gender']:checked").val();
            var oldPassword = $("#old_password").val();
            var repeatOldPassword = $("#repeat_old_password").val();
            var newPassword = $("#new_password").val();
            var repeatNewPassword = $("#repeat_new_password").val();

            // Validate password
            if (newPassword !== "" && newPassword !== repeatNewPassword) {
                alert("New password and repeat new password do not match.");
                return;
            }

            if (repeatOldPassword!=="" && oldPassword !== "" && oldPassword !== repeatOldPassword) {
                alert("Old password and repeat old password do not match.");
                return;
            }

            var userId = localStorage.getItem("userId");
            $("#updateForm").attr("action", "User/UpdateUser/" + userId);

            var formData = {
                "name": name,
                "email": email,
                "phone": phone,
                "password": newPassword === "" ? oldPassword : newPassword,
                "gender": gender
            };

            $.ajax({
                url: "http://localhost:8090/User/UpdateUser/" + userId,
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify(formData),
                success: function(data) {
                    console.log("User data updated successfully:", data);
                    location.reload();
                    //window.open("profile.html");
                    alert("User data updated successfully.");
                },
                error: function() {
                    console.error("Error");
                    alert("Error updating user data. Please try again later.");
                }
            });
        }

    </script>
    <script>

        if (localStorage.getItem('sessionId') == 0) {
        } else {
            window.location.href = '../user/signin.html';
        }
    </script>

</body>
</html>